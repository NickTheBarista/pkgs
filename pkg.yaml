name: kubeadm
finalize:
  - from: /rootfs
    to: /
steps:
  - sources:
      - url: https://storage.googleapis.com/kubernetes-release/release/v1.16.0-beta.1/bin/linux/amd64/kubeadm
        destination: kubeadm-linux-amd64
        sha256: 51c2074136f327bfcffdeeaa49dc74ca273f31d440050dbb603c74811d5cd380
        sha512: ff7f36658e0f2c215b369e3d8b2614751af2d7852ebde54ed0b7d761076ea4c0b7608b855fcce0aa75d6ad3898b5b61b83d7f5871fe372857f1f18ef04d46f4e
      - url: https://storage.googleapis.com/kubernetes-release/release/v1.16.0-beta.1/bin/linux/arm64/kubeadm
        destination: kubeadm-linux-arm64
        sha256: 5efb0efc838c002ae28914ec070e6273935bddee1137d2449aef4f6e69fed931
        sha512: 02c7db2b9ecda1609947729a4c462038a2d478cfa122981c80ad493d351f73c82120be2f432d1cba5f879055dcd1b441c170a4323f0add286aec84d4ddcff1db

    install: |
      mkdir -p /rootfs/bin

      case $ARCH in
          x86_64)
              cp kubeadm-linux-amd64 /rootfs/bin/kubeadm
          ;;
          aarch64)
              cp kubeadm-linux-arm64 /rootfs/bin/kubeadm
          ;;
          *)
              echo "unsupported arch ${ARCH}"
              exit 1
          ;;
      esac

      chmod +x /rootfs/bin/kubeadm
